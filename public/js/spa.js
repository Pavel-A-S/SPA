!function(t){var e={};function r(i){if(e[i])return e[i].exports;var o=e[i]={i:i,l:!1,exports:{}};return t[i].call(o.exports,o,o.exports,r),o.l=!0,o.exports}r.m=t,r.c=e,r.d=function(t,e,i){r.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:i})},r.r=function(t){Object.defineProperty(t,"__esModule",{value:!0})},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=1)}([function(t,e,r){"use strict";r.r(e);var i=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"modal fade",attrs:{id:"clientForm",tabindex:"-1",role:"dialog","aria-labelledby":"exampleModalLabel","aria-hidden":"true"}},[r("div",{staticClass:"modal-dialog",attrs:{role:"document"}},[r("div",{staticClass:"modal-content"},[t._m(0),t._v(" "),r("div",{staticClass:"modal-body"},[r("form",[r("div",{staticClass:"form-group"},[r("label",{attrs:{for:"name"}},[t._v("Name")]),t._v(" "),r("input",{directives:[{name:"model",rawName:"v-model",value:t.formClient.name,expression:"formClient.name"}],staticClass:"form-control",attrs:{type:"text",id:"name",placeholder:"Enter your name"},domProps:{value:t.formClient.name},on:{input:function(e){e.target.composing||t.$set(t.formClient,"name",e.target.value)}}})]),t._v(" "),r("div",{staticClass:"form-group"},[r("label",{attrs:{for:"email"}},[t._v("Email")]),t._v(" "),r("input",{directives:[{name:"model",rawName:"v-model",value:t.formClient.email,expression:"formClient.email"}],staticClass:"form-control",attrs:{type:"email",id:"email",placeholder:"Enter email"},domProps:{value:t.formClient.email},on:{input:function(e){e.target.composing||t.$set(t.formClient,"email",e.target.value)}}})]),t._v(" "),r("div",{staticClass:"form-group"},[r("label",{attrs:{for:"phone"}},[t._v("Phone")]),t._v(" "),r("input",{directives:[{name:"model",rawName:"v-model",value:t.formClient.phone,expression:"formClient.phone"}],staticClass:"form-control",attrs:{type:"text",id:"phone",placeholder:"Enter your phone"},domProps:{value:t.formClient.phone},on:{input:function(e){e.target.composing||t.$set(t.formClient,"phone",e.target.value)}}})]),t._v(" "),r("label",{attrs:{for:"providers"}},[t._v("Providers")]),t._v(" "),r("div",{staticClass:"input-group mb-3"},[r("input",{directives:[{name:"model",rawName:"v-model",value:t.formProvider.name,expression:"formProvider.name"}],staticClass:"form-control",attrs:{type:"text",id:"provider",placeholder:"Provider's name"},domProps:{value:t.formProvider.name},on:{input:function(e){e.target.composing||t.$set(t.formProvider,"name",e.target.value)}}}),t._v(" "),r("div",{staticClass:"input-group-append"},[t.formCreateProviderButton?r("button",{staticClass:"btn btn-outline-secondary",attrs:{type:"button"},on:{click:function(e){t.$emit("send-form","createProvider")}}},[t._v("\n                Add\n              ")]):t._e(),t._v(" "),t.formUpdateProviderButton?r("button",{staticClass:"btn btn-outline-secondary",attrs:{type:"button"},on:{click:function(e){t.$emit("send-form","updateProvider")}}},[t._v("\n                Update\n              ")]):t._e(),t._v(" "),t.formUpdateProviderButton?r("button",{staticClass:"btn btn-outline-secondary",attrs:{type:"button"},on:{click:function(e){t.$emit("set-provider-button","create")}}},[t._v("\n                Cancel\n              ")]):t._e()])]),t._v(" "),r("div",{staticClass:"row"},[r("div",{staticClass:"col-10 offset-1"},[""!=t.formProviderValidationError?r("div",{staticClass:"alert alert-danger text-center",attrs:{role:"alert"}},[t._v("\n                  "+t._s(t.formProviderValidationError)+"\n              ")]):t._e(),t._v(" "),r("table",{staticClass:"table table-sm border"},[r("tbody",t._l(t.formCurrentClientProviders,function(e){return r("tr",[r("td",{staticClass:"border-0"},[r("input",{attrs:{type:"checkbox",value:"test",id:e._id},domProps:{checked:e.state},on:{click:function(r){t.$emit("change-client-provider-state",e)}}})]),t._v(" "),r("td",{staticClass:"border-0"},[t._v(t._s(e.name))]),t._v(" "),r("td",{staticClass:"border-0 text-right"},[r("button",{staticClass:"btn btn-sm btn-link",attrs:{type:"button"},on:{click:function(r){t.$emit("set-provider-button","edit",e)}}},[r("img",{staticClass:"glyph-icon",attrs:{src:"libs/glyph-smarticons/svg/si-glyph-edit.svg"}})]),t._v(" "),r("button",{staticClass:"btn btn-sm btn-link",attrs:{type:"button"},on:{click:function(r){t.$emit("send-delete-provider",e)}}},[r("img",{staticClass:"glyph-icon",attrs:{src:"libs/glyph-smarticons/svg/si-glyph-trash.svg"}})])])])}))])])])])]),t._v(" "),r("div",{staticClass:"modal-footer"},[r("button",{staticClass:"btn btn-danger mr-auto float-left",attrs:{type:"button","data-dismiss":"modal"},on:{click:function(e){t.$emit("send-delete-client",t.formClient)}}},[t._v("\n          Delete\n        ")]),t._v(" "),r("button",{staticClass:"btn btn-secondary",attrs:{type:"button","data-dismiss":"modal"}},[t._v("\n          Close\n        ")]),t._v(" "),r("button",{staticClass:"btn btn-primary",attrs:{type:"button","data-dismiss":"modal"},on:{click:function(e){t.$emit("send-form")}}},[t._v("\n          Save\n        ")])])])])])};i._withStripped=!0;var o=function(t,e,r,i,o,s,n,a){var d,l="function"==typeof t?t.options:t;if(e&&(l.render=e,l.staticRenderFns=r,l._compiled=!0),i&&(l.functional=!0),s&&(l._scopeId="data-v-"+s),n?(d=function(t){(t=t||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext)||"undefined"==typeof __VUE_SSR_CONTEXT__||(t=__VUE_SSR_CONTEXT__),o&&o.call(this,t),t&&t._registeredComponents&&t._registeredComponents.add(n)},l._ssrRegister=d):o&&(d=a?function(){o.call(this,this.$root.$options.shadowRoot)}:o),d)if(l.functional){l._injectStyles=d;var c=l.render;l.render=function(t,e){return d.call(e),c(t,e)}}else{var v=l.beforeCreate;l.beforeCreate=v?[].concat(v,d):[d]}return{exports:t,options:l}}({props:["client","provider","createProviderButton","updateProviderButton","currentClientProviders","providerValidationError"],data(){return{formCurrentClientProviders:this.currentClientProviders,formCreateProviderButton:this.createProviderButton,formUpdateProviderButton:this.updateProviderButton,formClient:this.client,formProvider:this.provider,formProviderValidationError:this.providerValidationError}},watch:{currentClientProviders(t){this.formCurrentClientProviders=t},provider(t){this.formProvider=t},createProviderButton(t){this.formCreateProviderButton=t},updateProviderButton(t){this.formUpdateProviderButton=t},providerValidationError(t){this.formProviderValidationError=t}}},i,[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"modal-header"},[e("h5",{staticClass:"modal-title",attrs:{id:"exampleModalLabel"}},[this._v("Client")]),this._v(" "),e("button",{staticClass:"close",attrs:{type:"button","data-dismiss":"modal","aria-label":"Close"}},[e("span",{attrs:{"aria-hidden":"true"}},[this._v("Ã—")])])])}],!1,null,null,null);o.options.__file="vue-components/spa-modal.vue";var s=o.exports;Vue.component("client-form",s),new Vue({el:"#root",data:{validationError:"",providerValidationError:"",clients:[],providers:[],createProviderButton:!0,updateProviderButton:!1,provider:{_id:null,name:""},client:{name:"",email:"",phone:"",providers:[]},clientsProvidersNames:[],currentClientProviders:{}},computed:{setClientProvidersNames(){this.clientsProvidersNames={},this.clients.forEach(t=>{var e="";t.providers.forEach(r=>{this.providers.forEach(i=>{i._id===r&&(e=""===e?i.name:e+", "+i.name,this.clientsProvidersNames[t._id]=e)})})})},setProviderCheckboxState(){this.currentClientProviders=JSON.parse(JSON.stringify(this.providers)),this.currentClientProviders.forEach(t=>{this.client.providers.findIndex(e=>e._id===t._id)>=0?t.state=!0:t.state=!1})}},methods:{setProviderButton(t,e=null){this.providerValidationError="","edit"===t?(this.createProviderButton=!1,this.updateProviderButton=!0,this.provider=e):"create"===t&&(this.createProviderButton=!0,this.updateProviderButton=!1,this.provider={_id:null,name:null})},changeClientProviderState(t){var e=this.currentClientProviders.findIndex(e=>e._id===t._id);t.state?(this.client.providers=this.client.providers.filter(e=>e._id!=t._id),this.currentClientProviders[e].state=!1):(this.client.providers.push(Object.assign({},this.providers[e])),this.currentClientProviders[e].state=!0)},sendForm(t){"createProvider"===t?(this.providerValidationError="",this.sendNewProviderForm()):"updateProvider"===t?(this.providerValidationError="",this.sendUpdatedProviderForm()):""===this.client._id?this.sendNewClientForm():this.sendUpdatedClientForm()},clientProviders:function(t=[]){this.client.providers=[],t.forEach(t=>{this.providers.forEach(e=>{e._id===t&&this.client.providers.push(e)})})},fillCreateClientForm(){this.validationError="",this.client._id="",this.client.name="",this.client.email="",this.client.phone="",this.provider.name="",this.clientProviders(),this.setProviderCheckboxState,this.setProviderButton("create")},fillEditClientForm(t){this.validationError="",this.client._id=t._id,this.client.name=t.name,this.client.email=t.email,this.client.phone=t.phone,this.clientProviders(t.providers),this.setProviderCheckboxState,this.setProviderButton("create")},sendDeleteClient(t){this.validationError="",axios.delete(`/clients/${t._id}`).then(t=>{this.getNewData()}).catch(t=>{console.log(t)})},sendDeleteProvider(t){this.providerValidationError="",axios.delete(`/providers/${t._id}`).then(t=>{this.getNewData()}).catch(t=>{console.log(t)})},sendUpdatedClientForm(){axios.put(`/clients/${this.client._id}`,{name:this.client.name,email:this.client.email,phone:this.client.phone,providers:this.client.providers}).then(t=>{t.data&&"validation error"===t.data.message&&(this.validationError=t.data.response),this.getNewData()}).catch(t=>{console.log(t)})},sendNewClientForm(){axios.post("/clients",{name:this.client.name,email:this.client.email,phone:this.client.phone,providers:this.client.providers}).then(t=>{t.data&&"validation error"===t.data.message&&(this.validationError=t.data.response),this.getNewData()}).catch(t=>{console.log(t)})},sendNewProviderForm(){axios.post("/providers",{name:this.provider.name}).then(t=>{t.data&&"validation error"===t.data.message&&(this.providerValidationError=t.data.response),this.getNewData()}).catch(t=>{console.log(t)})},sendUpdatedProviderForm(){axios.put(`/providers/${this.provider._id}`,{name:this.provider.name}).then(t=>{this.setProviderButton("create"),t.data&&"validation error"===t.data.message&&(this.providerValidationError=t.data.response),this.getNewData()}).catch(t=>{console.log(t)})},getNewData(){axios.get("/clients").then(t=>{this.clients=t.data.clients,this.providers=t.data.providers,this.setClientProvidersNames,this.setProviderCheckboxState,this.provider.name=""})}},mounted(){this.getNewData()}})},function(t,e,r){t.exports=r(0)}]);